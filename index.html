<!doctype html>
<html lang="da">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Checklister Varm ende ‚Äî ROCKWOOL</title>
  <style>
    :root{
      --rock-red:#E60028; --bg:#f3f4f6; --card:#ffffff; --text:#111111;
      --muted:#6b7280; --heading-bg:#E8EAF6; --heading-color:#1A237E;
      --note-bg:#FFFDE7; --note-color:#757575; --minus-red:#b91c1c;
      --minus-bg:#fee2e2; --minus-border:#dc2626;
    }
    /* Dark Mode farver */
    body.dark {
      --bg:#0f172a; --card:#1f2933; --text:#f9fafb; --muted:#9ca3af;
      --heading-bg:#1e293b; --heading-color:#e2e8f0; --note-bg:#1e1b4b;
    }

    html,body{ margin:0; font-family:system-ui,Arial; background-color:var(--bg); color:var(--text); transition: background 0.3s; }
    header{ background:var(--rock-red); color:#fff; padding:14px; position:sticky; top:0; z-index:1000; display:flex; justify-content:space-between; align-items:center; }
    #progressWrapper{ position:fixed; left:0; right:0; top:50px; display:none; align-items:center; padding:10px; z-index:1200; background:var(--card); border-bottom:1px solid var(--muted); flex-direction:column; }
    .progress-track{ width:80%; height:12px; background:#e5e7eb; border-radius:10px; overflow:hidden; margin: 5px 0; }
    .progress-fill{ height:100%; width:0%; background:var(--rock-red); transition: width .3s; }
    main{ max-width:900px; margin:20px auto; padding:0 15px; }
    .card{ background:var(--card); border-radius:8px; padding:15px; box-shadow:0 2px 5px rgba(0,0,0,0.1); margin-bottom:20px; }
    .item{ display:flex; gap:10px; padding:12px; border-bottom:1px solid #eee; align-items: flex-start; }
    .done label{ text-decoration: line-through; opacity: 0.5; }
    .minus-state label{ color: var(--minus-red); text-decoration: underline; font-weight: bold; }
    button{ background:var(--rock-red); color:#fff; border:none; padding:10px 20px; border-radius:6px; cursor:pointer; font-weight:700; }
    button.ghost{ background:none; border:1px solid var(--rock-red); color:var(--rock-red); }
    
    /* Modal / Indstillinger */
    #settingsModal {
      display:none; position:fixed; top:0; left:0; width:100%; height:100%; 
      background:rgba(0,0,0,0.7); z-index:2000; justify-content:center; align-items:center;
    }
    .modal-content { background:var(--card); padding:20px; border-radius:8px; width:90%; max-width:400px; }
    input { width:100%; padding:10px; margin:5px 0 15px; border-radius:6px; border:1px solid #ccc; box-sizing:border-box; background:inherit; color:inherit; }
  </style>
</head>
<body>

<header>
  <div style="display:flex; gap:10px; align-items:center;">
    <h1 style="margin:0; font-size:20px;">Checklister</h1>
  </div>
  <div style="display:flex; gap:15px; align-items:center;">
    <button onclick="toggleTheme()" style="background:none; font-size:20px; padding:0;">üåì</button>
    <button id="btnOpenSettings" style="background:none; font-size:20px; padding:0;">‚öôÔ∏è</button>
    <div style="font-weight:700;">ROCKWOOL</div>
  </div>
</header>

<div id="settingsModal">
  <div class="modal-content">
    <h3>Indstillinger</h3>
    <div id="unlockSection">
      <label>Indtast PIN for at rette (Standard: 1234)</label>
      <input type="password" id="settingsPin" placeholder="PIN-kode">
      <button onclick="unlockSettings()" style="width:100%">L√•s op</button>
    </div>
    <div id="configSection" style="display:none;">
      <label>Email Modtager 1</label>
      <input type="email" id="email1" placeholder="email@dom√¶ne.dk">
      <label>Email Modtager 2</label>
      <input type="email" id="email2" placeholder="email@dom√¶ne.dk">
      <button onclick="saveSettings()" style="width:100%">Gem & Luk</button>
    </div>
    <button onclick="closeSettings()" class="ghost" style="width:100%; margin-top:10px;">Annuller</button>
  </div>
</div>

<div id="progressWrapper">
  <div class="progress-track"><div id="progressFill" class="progress-fill"></div></div>
  <div id="progressText" style="font-size:12px; font-weight:700;">0% ¬∑ 0/0</div>
  <div style="display:flex; gap:10px; margin-top:5px;">
    <button id="btnMinusMode" type="button" class="ghost" style="font-size:12px;">Minus til n√¶ste opgave</button>
  </div>
</div>

<main>
  <section id="page-home" class="card">
    <label>V√¶lg liste</label>
    <select id="homeChecklistSelect" style="width:100%; padding:10px; margin-bottom:15px; border-radius:6px;"></select>
    
    <label>Arbejdsnummer (5 cifre)</label>
    <input id="homeWorkNr" type="text" maxlength="5" placeholder="fx 01234">
    <div id="workHelp" class="helper" style="display:none">Skal v√¶re 5 cifre.</div>

    <label>Dato</label>
    <input id="homeDate" type="date" readonly style="background:#eee; color:#666;">
    
    <button id="btnStart" style="width:100%; margin-top:20px;">Start Checklist</button>
  </section>

  <section id="page-checklist" class="card" style="display:none">
    <div style="display:flex; justify-content:space-between;">
      <div id="chkTitle" style="font-weight:800; font-size:18px;"></div>
      <button id="btnBack" class="ghost">Tilbage</button>
    </div>
    <div id="itemsContainer" style="margin-top:20px;"></div>
    <details id="completedSection" style="margin-top:20px;"><summary id="completedSummary">Udf√∏rte opgaver (0)</summary><div id="completedContainer"></div></details>
    <textarea id="comment" placeholder="Generel kommentar..."></textarea>
    <button id="btnSend" style="width:100%; margin-top:15px; display:none;">Send Rapport</button>
  </section>
</main>

<script>
    const MASTER_PIN = "1234"; // Skift din PIN her
    const checklists = {
        "Aquila opstart - Spinder passer": ["Drej n√∏gle til Energen", "Gennemg√• alarmlisten", "Start k√∏levandssystemet"],
        "Opstartsliste K√¶ldermand Aquila L5": ["F√∏r opstart runderes anl√¶gget", "Inspicer Smeltecyklon", "Luk l√•gen p√• cykloner"],
        "K√¶ldermand rundgang": ["Tromlerens:", "Kontroller dyser", "Pumperum:", "Tjek filtre"]
    };

    // --- DARK MODE LOGIK ---
    function toggleTheme() {
        document.body.classList.toggle('dark');
        localStorage.setItem('theme', document.body.classList.contains('dark') ? 'dark' : 'light');
    }
    if(localStorage.getItem('theme') === 'dark') document.body.classList.add('dark');

    // --- INDSTILLINGER LOGIK ---
    const modal = document.getElementById('settingsModal');
    document.getElementById('btnOpenSettings').onclick = () => {
        modal.style.display = 'flex';
        document.getElementById('unlockSection').style.display = 'block';
        document.getElementById('configSection').style.display = 'none';
        document.getElementById('settingsPin').value = '';
    };

    function unlockSettings() {
        if(document.getElementById('settingsPin').value === MASTER_PIN) {
            document.getElementById('unlockSection').style.display = 'none';
            document.getElementById('configSection').style.display = 'block';
            document.getElementById('email1').value = localStorage.getItem('email1') || "";
            document.getElementById('email2').value = localStorage.getItem('email2') || "";
        } else {
            alert("Forkert PIN!");
        }
    }

    function saveSettings() {
        localStorage.setItem('email1', document.getElementById('email1').value);
        localStorage.setItem('email2', document.getElementById('email2').value);
        closeSettings();
    }

    function closeSettings() { modal.style.display = 'none'; }

    // --- APP LOGIK ---
    document.getElementById('homeDate').valueAsDate = new Date();
    const sel = document.getElementById('homeChecklistSelect');
    Object.keys(checklists).forEach(k => {
        const o = document.createElement('option'); o.value = k; o.innerText = k; sel.appendChild(o);
    });

    let minusActive = false;
    document.getElementById('btnMinusMode').onclick = function() {
        minusActive = !minusActive;
        this.style.background = minusActive ? "var(--minus-red)" : "";
        this.style.color = minusActive ? "white" : "";
    };

    document.getElementById('btnStart').onclick = () => {
        if(document.getElementById('homeWorkNr').value.length !== 5) {
            document.getElementById('workHelp').style.display = 'block';
            return;
        }
        document.getElementById('page-home').style.display = 'none';
        document.getElementById('page-checklist').style.display = 'block';
        document.getElementById('progressWrapper').style.display = 'flex';
        render(sel.value);
    };

    function render(name) {
        const container = document.getElementById('itemsContainer');
        document.getElementById('chkTitle').innerText = name;
        container.innerHTML = '';
        checklists[name].forEach((t, i) => {
            const div = document.createElement('div');
            div.className = 'item task';
            div.dataset.index = i;
            if(t.endsWith(':')) {
                div.innerHTML = `<label style="font-weight:800; color:var(--rock-red)">${t}</label>`;
            } else {
                const cb = document.createElement('input'); cb.type = 'checkbox';
                cb.onchange = () => {
                    if(minusActive && cb.checked) {
                        const r = prompt("√Örsag til minus:");
                        if(!r) { cb.checked = false; return; }
                        div.classList.add('minus-state'); div.dataset.reason = r;
                        minusActive = false; document.getElementById('btnMinusMode').style = "";
                    }
                    if(cb.checked) {
                        div.classList.add('done');
                        setTimeout(() => { document.getElementById('completedContainer').appendChild(div); updateUI(); }, 200);
                    } else {
                        div.classList.remove('done', 'minus-state');
                        const items = document.getElementById('itemsContainer');
                        const children = Array.from(items.children);
                        const next = children.find(c => parseInt(c.dataset.index) > i);
                        next ? items.insertBefore(div, next) : items.appendChild(div);
                    }
                    updateUI();
                };
                div.append(cb, Object.assign(document.createElement('label'), {innerText: t}));
            }
            container.appendChild(div);
        });
        updateUI();
    }

    function updateUI() {
        const total = document.querySelectorAll('.item.task').length;
        const done = document.querySelectorAll('.item.task.done').length;
        const pct = total ? Math.round((done/total)*100) : 0;
        document.getElementById('progressFill').style.width = pct + '%';
        document.getElementById('progressText').innerText = `${pct}% ¬∑ ${done}/${total}`;
        document.getElementById('btnSend').style.display = (done === total && total > 0) ? 'block' : 'none';
        document.getElementById('completedSummary').innerText = `Udf√∏rte opgaver (${document.getElementById('completedContainer').children.length})`;
    }

    document.getElementById('btnSend').onclick = () => {
        const e1 = localStorage.getItem('email1') || "";
        const e2 = localStorage.getItem('email2') || "";
        const recipients = [e1, e2].filter(e => e).join(',');
        
        let body = `Checkliste: ${document.getElementById('chkTitle').innerText}\nArbejdsnr: ${document.getElementById('homeWorkNr').value}\n\n`;
        document.querySelectorAll('.minus-state').forEach(el => {
            body += `[MINUS] ${el.querySelector('label').innerText}: ${el.dataset.reason}\n`;
        });
        body += `\nKommentar: ${document.getElementById('comment').value}`;
        
        window.location.href = `mailto:${recipients}?subject=Checkliste Rapport&body=${encodeURIComponent(body)}`;
    };

    document.getElementById('btnBack').onclick = () => location.reload();
</script>
</body>
</html>
