<!doctype html>
<html lang="da">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Checklister Varm ende — ROCKWOOL</title>
  <style>
    :root{
      --rock-red:#E60028; --bg:#f3f4f6; --card:#ffffff; --text:#111111;
      --muted:#6b7280; --heading-bg:#E8EAF6; --heading-color:#1A237E;
      --note-bg:#FFFDE7; --note-color:#757575; --minus-red:#b91c1c;
      --minus-bg:#fee2e2; --minus-border:#dc2626;
    }
    html,body{ margin:0; font-family:system-ui,Arial; background-color:var(--bg); color:var(--text); }
    header{ background:var(--rock-red); color:#fff; padding:14px; position:sticky; top:0; z-index:1000; }
    #progressWrapper{ position:fixed; left:0; right:0; top:50px; display:none; align-items:center; padding:10px; z-index:1200; background:rgba(255,255,255,0.95); border-bottom:1px solid #e5e7eb; flex-direction:column; }
    .progress-track{ width:80%; height:12px; background:#e5e7eb; border-radius:10px; overflow:hidden; margin: 5px 0; }
    .progress-fill{ height:100%; width:0%; background:var(--rock-red); transition: width .3s; }
    main{ max-width:900px; margin:20px auto; padding:0 15px; }
    .card{ background:var(--card); border-radius:8px; padding:15px; box-shadow:0 2px 5px rgba(0,0,0,0.1); margin-bottom:20px; }
    .item{ display:flex; gap:10px; padding:12px; border-bottom:1px solid #eee; align-items: flex-start; }
    .item.task input[type="checkbox"]{ width:22px; height:22px; flex-shrink:0; cursor:pointer; }
    .item.heading{ background:var(--heading-bg); color:var(--heading-color); font-weight:700; border-left:5px solid var(--heading-color); }
    .item.note{ background:var(--note-bg); font-style:italic; border-left:5px solid #FFC107; }
    .done label{ text-decoration: line-through; opacity: 0.5; color: var(--rock-red); }
    .minus-state label{ color: var(--minus-red); text-decoration: underline; font-weight: bold; }
    button{ background:var(--rock-red); color:#fff; border:none; padding:10px 20px; border-radius:6px; cursor:pointer; font-weight:700; }
    button.ghost{ background:none; border:1px solid var(--rock-red); color:var(--rock-red); }
    #btnMinusMode.active { background: var(--minus-red); color: white; }
    textarea{ width:100%; min-height:80px; margin-top:10px; border-radius:6px; border:1px solid #ccc; padding:10px; box-sizing: border-box; }
    .helper{ color:var(--minus-red); font-size:13px; margin-top:5px; }
  </style>
</head>
<body>

<header id="mainHeader">
  <div style="display:flex;justify-content:space-between;align-items:center">
    <h1>Checklister</h1>
    <div style="font-weight:700;">ROCKWOOL</div>
  </div>
</header>

<div id="progressWrapper">
  <div class="progress-track"><div id="progressFill" class="progress-fill"></div></div>
  <div id="progressText" style="font-size:12px; font-weight:700;">0% · 0/0</div>
  <div id="minusToggleBar" style="display:flex; align-items:center; gap:10px; margin-top:5px;">
    <button id="btnMinusMode" type="button" class="ghost">Minus til næste opgave</button>
    <span style="font-size:11px; color:var(--muted)">Aktivér for at markere én fejl/minus</span>
  </div>
</div>

<main>
  <section id="page-home" class="card">
    <div style="font-weight:800; margin-bottom:15px;">Vælg liste og indtast arbejdsnummer</div>
    <label>Vælg liste</label>
    <select id="homeChecklistSelect"></select>
    
    <div style="margin-top:15px;">
      <label>Arbejdsnummer (5 cifre)</label>
      <input id="homeWorkNr" type="text" maxlength="5" placeholder="fx 01234" style="width:100%; padding:10px; margin-top:5px;">
      <div id="workHelp" class="helper" style="display:none">Skal være 5 cifre.</div>
    </div>

    <div style="margin-top:15px;">
      <label>Dato</label>
      <input id="homeDate" type="date" readonly style="width:100%; padding:10px; background:#eee;">
    </div>
    
    <button id="btnStart" style="width:100%; margin-top:20px;">Start Checklist</button>
  </section>

  <section id="page-checklist" class="card" style="display:none">
    <div style="display:flex; justify-content:space-between; align-items:flex-start;">
      <div>
        <div id="chkTitle" style="font-weight:800; font-size:18px;"></div>
        <div id="chkMeta" style="font-size:12px; color:var(--muted)"></div>
      </div>
      <button id="btnBack" class="ghost">Tilbage</button>
    </div>

    <div id="itemsContainer" style="margin-top:20px;"></div>

    <details id="completedSection" style="margin-top:20px; border-top:1px dashed #ccc;">
      <summary id="completedSummary" style="padding:10px; cursor:pointer; font-weight:700;">Udførte opgaver (0)</summary>
      <div id="completedContainer"></div>
    </details>

    <div style="margin-top:20px;">
      <label>Generel kommentar (valgfri)</label>
      <textarea id="comment"></textarea>
    </div>

    <div style="margin-top:15px; display:flex; gap:10px;">
      <button id="btnClearAll" class="ghost">Nulstil</button>
      <button id="btnSend" style="flex-grow:1; display:none;">Send Rapport</button>
    </div>
  </section>
</main>

<script>
    const checklists = {
        "Aquila opstart - Spinder passer": [
            "Drej nøgle til Energen anlægget ved manuel", "Gennemgå alarmlisten.", "Start kølevandssystemet i Group mode", 
            "Åben gas og ilt haner i Aquila kølerummet", "Opstart anlæg: Vælg Group mode", "Smeltestart:", "Start DrySoTec anlæget på billede 2135."
        ],
        "Opstartsliste Kældermand Aquila L5": [
            "Før opstart runderes anlægget :", "Inspicer Smeltecyklon + Cyklon 1 + Cyklon 2", "Luk lågen på cykloner 1 og 2", "Tappelanser er klargjort.", "Køling af sifon og bakker er åbnet."
        ],
        "Kældermand rundgang": [
            "Tromlerens:", "Kontroller at dyserne sprøjter korrekt", "Fjern opbygninger omkring forspaltevalse", "Pumperum:", "Kontroller at filtre i dagtanken ikke er stoppede"
        ]
    };

    const state = { minusMode: false, currentTasks: [] };

    // Initialisering
    document.getElementById('homeDate').valueAsDate = new Date();
    const sel = document.getElementById('homeChecklistSelect');
    Object.keys(checklists).forEach(key => {
        const opt = document.createElement('option');
        opt.value = key; opt.textContent = key;
        sel.appendChild(opt);
    });

    document.getElementById('btnStart').onclick = () => {
        const nr = document.getElementById('homeWorkNr').value;
        if(nr.length !== 5) {
            document.getElementById('workHelp').style.display = 'block';
            return;
        }
        document.getElementById('page-home').style.display = 'none';
        document.getElementById('page-checklist').style.display = 'block';
        document.getElementById('progressWrapper').style.display = 'flex';
        render(sel.value);
    };

    document.getElementById('btnBack').onclick = () => location.reload();

    document.getElementById('btnMinusMode').onclick = function() {
        state.minusMode = !state.minusMode;
        this.classList.toggle('active', state.minusMode);
    };

    function render(name) {
        const container = document.getElementById('itemsContainer');
        const meta = document.getElementById('chkMeta');
        document.getElementById('chkTitle').textContent = name;
        meta.textContent = `Arbejdsnr: ${document.getElementById('homeWorkNr').value} | Dato: ${document.getElementById('homeDate').value}`;
        
        container.innerHTML = '';
        checklists[name].forEach((text, index) => {
            const div = document.createElement('div');
            div.className = 'item';
            div.dataset.index = index;

            if(text.endsWith(':')) {
                div.classList.add('heading');
                div.innerHTML = `<label>${text}</label>`;
            } else {
                div.classList.add('task');
                const cb = document.createElement('input');
                cb.type = 'checkbox';
                const lbl = document.createElement('label');
                lbl.textContent = text;
                
                cb.onchange = () => handleToggle(cb, div);
                div.append(cb, lbl);
            }
            container.appendChild(div);
        });
        updateUI();
    }

    function handleToggle(cb, div) {
        if(state.minusMode && cb.checked) {
            const reason = prompt("Angiv årsag til minus-markering:");
            if(!reason) { cb.checked = false; return; }
            div.classList.add('minus-state');
            div.dataset.reason = reason;
            state.minusMode = false;
            document.getElementById('btnMinusMode').classList.remove('active');
        } else if (!cb.checked) {
            div.classList.remove('minus-state', 'done');
            delete div.dataset.reason;
        }

        if(cb.checked) {
            div.classList.add('done');
            setTimeout(() => {
                document.getElementById('completedContainer').appendChild(div);
                updateUI();
            }, 300);
        } else {
            const items = document.getElementById('itemsContainer');
            insertInOrder(div, items);
            updateUI();
        }
    }

    function insertInOrder(el, container) {
        const idx = parseInt(el.dataset.index);
        const children = Array.from(container.children);
        const next = children.find(c => parseInt(c.dataset.index) > idx);
        next ? container.insertBefore(el, next) : container.appendChild(el);
    }

    function updateUI() {
        const tasks = document.querySelectorAll('.item.task');
        const completed = document.querySelectorAll('.item.task.done').length + document.querySelectorAll('.item.task.minus-state').length;
        const total = tasks.length;
        const pct = total ? Math.round((completed/total)*100) : 0;

        document.getElementById('progressFill').style.width = pct + '%';
        document.getElementById('progressText').textContent = `${pct}% · ${completed}/${total}`;
        document.getElementById('completedSummary').textContent = `Udførte opgaver (${document.getElementById('completedContainer').children.length})`;
        document.getElementById('btnSend').style.display = (completed === total && total > 0) ? 'block' : 'none';
        document.getElementById('completedSection').style.display = document.getElementById('completedContainer').children.length ? 'block' : 'none';
    }

    document.getElementById('btnSend').onclick = () => {
        let report = `Checkliste: ${document.getElementById('chkTitle').textContent}\n`;
        report += `Arbejdsnummer: ${document.getElementById('homeWorkNr').value}\n\n`;
        
        document.querySelectorAll('.minus-state').forEach(el => {
            report += `[MINUS] ${el.querySelector('label').textContent}: ${el.dataset.reason}\n`;
        });
        
        report += `\nGenerel kommentar: ${document.getElementById('comment').value}`;
        
        const mailto = `mailto:modtager@rockwool.com?subject=Checkliste Fuldført&body=${encodeURIComponent(report)}`;
        window.location.href = mailto;
    };

    document.getElementById('btnClearAll').onclick = () => { if(confirm("Vil du rydde alle markeringer?")) location.reload(); };
</script>

</body>
</html>
